services:
  test:
    build:
      context: .
      dockerfile: Dockerfile
    # Coverage thresholds:
    # - Lines: 99% (auto-generated clap derive code excluded from 100%)
    # - Functions: 97% (clap derive implementations like augment_args, from_arg_matches)
    # All business logic is 100% covered; derive macros generate untestable code.
    command: ["cargo", "llvm-cov", "--all-features", "--workspace", "--fail-under-lines", "99", "--fail-under-functions", "97"]

  build:
    build:
      context: .
      dockerfile: Dockerfile
    command: cargo build --release
