services:
  test:
    build:
      context: .
      dockerfile: Dockerfile
    # Coverage thresholds:
    # - Lines: 99% (auto-generated derive macro code excluded from 100%)
    # - Functions: 95% (derive macros and mock implementations with multiple trait methods)
    # All business logic is 100% covered; derive macros generate untestable code.
    command: ["cargo", "llvm-cov", "--all-features", "--workspace", "--fail-under-lines", "99", "--fail-under-functions", "95"]

  build:
    build:
      context: .
      dockerfile: Dockerfile
    command: cargo build --release
